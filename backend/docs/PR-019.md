# PR-019 — BinanceExchangeInfoUniverse

## Goal

Replace the static symbol universe (PR-018) with a dynamic provider that fetches tradable symbols from Binance using the public `exchangeInfo` endpoint.

This provider will:

* Fetch symbols from Binance REST API
* Filter to USDT spot trading pairs
* Return only symbols with status `TRADING`
* Optionally limit results to top-N (configurable)

This PR introduces **dynamic discovery** while keeping the application layer unchanged.

---

## Scope

### Included

* `BinanceExchangeInfoUniverse` implementation (infrastructure layer)
* HTTP client abstraction (if not already present)
* Filtering logic (quote asset = USDT, status = TRADING)
* Optional max symbol limit parameter
* Unit tests with mocked HTTP responses

### Excluded

* Volume-based sorting (future PR)
* Caching layer (can be added later)
* Persistence
* Changes to ranking logic

---

## Architecture Placement

### Interface (already exists from PR-018)

```
application/symbol_universe/SymbolUniverseProvider
```

### Implementation (new)

```
infrastructure/symbol_universe/binance_exchange_info_universe.go
```

---

## Binance Endpoint Used

```
GET https://api.binance.com/api/v3/exchangeInfo
```

Relevant response fields:

* `symbols[].symbol`
* `symbols[].status`
* `symbols[].quoteAsset`
* `symbols[].isSpotTradingAllowed`

---

## Filtering Rules

A symbol is included if:

1. `status == "TRADING"`
2. `quoteAsset == "USDT"`
3. `isSpotTradingAllowed == true`

No leverage tokens, no futures.

---

## Optional Limiting

Constructor accepts:

```go
type BinanceExchangeInfoUniverse struct {
    client  *http.Client
    baseURL string
    limit   int
}
```

Behavior:

* If `limit > 0`, return first N filtered symbols
* If `limit == 0`, return all filtered symbols

Order is preserved as returned by Binance.

---

## Error Handling

* Network errors → return error
* Non-200 response → return error
* Malformed JSON → return error

No retries in this PR.

---

## Tests

Location:

```
test/infrastructure/symbol_universe/
```

Use httptest.Server to simulate Binance API.

### Required Test Cases

1. **FiltersOnlyUsdtTradingPairs**
2. **RespectsLimitParameter**
3. **ReturnsErrorOnNon200Response**
4. **ReturnsErrorOnInvalidJson**
5. **ReturnsEmptyIfNoMatchingSymbols**

All tests must be deterministic and avoid real network calls.

---

## Wiring

In `cmd/server/main.go`:

Replace:

```go
universe := static_universe.New(...)
```

With:

```go
universe := binance_universe.New(http.DefaultClient, "https://api.binance.com", 15)
```

No other changes required.

---

## Acceptance Criteria

* `/api/rankings` dynamically reflects current Binance tradable USDT pairs
* Application layer remains untouched
* All tests pass without network dependency
* No global variables introduced

---

## Future Enhancements

* PR-020: Volume-based ranking of universe
* PR-021: Redis caching of exchangeInfo response
* PR-022: Configurable quote asset (e.g., BTC, BUSD)

---

## Notes

This PR upgrades the system from static configuration to live market discovery while maintaining clean architecture boundaries.
