# PR-010 — Composition Root & Application Wiring

## Purpose

Introduce the **composition root** for the backend application.

This PR wires together:

* HTTP adapter
* Application use case
* Repository decorators
* Infrastructure adapter

No business logic is introduced. This PR answers **"how things are connected"**, not **"what they do"**.

---

## References

* `AGENTS.md` — global collaboration rules
* `BACKEND.md` — backend architecture & PR sequencing
* `COMMON.md` — shared runtime semantics
* `docs/PR-006.md` — GetCandleSeries use case
* `docs/PR-007.md` — HTTP adapter
* `docs/PR-008.md` — Free-tier infra adapter
* `docs/PR-009.md` — Redis cache decorator

All wiring must respect dependency direction defined in these documents.

---

## Scope (Hard Lock)

### ✅ Included

* Application entry point
* Dependency wiring
* Minimal HTTP server bootstrap
* Composition tests

### ❌ Excluded

* Business logic
* New domain or application concepts
* Advanced configuration management
* Environment validation

If it is not **wiring or startup**, it does not belong here.

---

## Allowed Files

```
/backend/cmd/server/main.go
/backend/tests/composition/composition_test.go
```

No other files may be modified.

---

## Composition Responsibilities

### Dependency Graph

The runtime graph must be:

```
HTTP Handler
  → GetCandleSeries Use Case
    → RedisCandleRepository (optional)
      → FreeTierCandleRepository
```

Redis decorator must be **optional and configurable**.

---

### Configuration Inputs

* HTTP listen address
* External API base URL
* Redis connection string (optional)
* Cache TTL

Configuration may be provided via:

* environment variables
* constructor arguments

No configuration files are introduced in this PR.

---

### Startup Rules

* Application must fail fast on invalid configuration
* HTTP server must start only after successful wiring
* No global mutable state

---

## Behavioral Specification (Tests Must Cover All)

### Required Test Cases (Minimum)

* `TestComposition_WiresWithoutRedis`
* `TestComposition_WiresWithRedis`
* `TestComposition_HTTPHandlerIsReachable`

Tests may use fakes instead of real network listeners.

---

## Implementation Constraints

* Composition logic lives only in `main.go`
* No dependency injection frameworks
* Explicit wiring only
* Standard library HTTP server

---

## Definition of Done (PR-010)

PR-010 is considered **done** only when **all** conditions below are met:

* [ ] Application starts with minimal configuration
* [ ] Dependencies are wired explicitly
* [ ] Redis decorator is optional
* [ ] No business logic exists in composition
* [ ] Composition tests pass
* [ ] No files outside allowed list are changed
* [ ] Static analysis passes with no new warnings
* [ ] CI pipeline is green
* [ ] PR is reviewable in under 20 minutes

---

## Explicit Non-Goals

* No graceful shutdown handling
* No TLS setup
* No CLI flags parsing

---

## Reviewer Checklist

Reviewer must confirm:

* Dependency direction is correct
* No hidden logic in wiring
* Configuration surface is minimal

---

## Guiding Principle

Composition is where decisions end, not begin.
