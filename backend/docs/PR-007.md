# PR-007 — HTTP Adapter: GetCandleSeries Endpoint

## Purpose

Introduce the first **HTTP adapter** that exposes the `GetCandleSeries` use case via a REST API.

This PR translates HTTP requests into application inputs and application outputs into HTTP responses, without adding business logic.

---

## References

* `AGENTS.md` — global collaboration rules
* `BACKEND.md` — backend architecture & PR sequencing
* `COMMON.md` — shared API & domain semantics
* `docs/PR-005.md` — CandleRepositoryPort
* `docs/PR-006.md` — GetCandleSeries use case

All definitions in this PR must be consistent with the above.

---

## Scope (Hard Lock)

### ✅ Included

* HTTP handler for GetCandleSeries
* Request parsing & response serialization
* HTTP adapter unit tests

### ❌ Excluded

* Web framework configuration beyond minimal setup
* Authentication / authorization
* Rate limiting
* Caching
* Infrastructure adapters

If it is not **HTTP translation**, it does not belong here.

---

## Allowed Files

```
/backend/adapters/http/getcandleseries_handler.go
/backend/tests/adapters/http/getcandleseries_handler_test.go
```

No other files may be modified.

---

## Endpoint Definition

### Method & Path

```
GET /api/v1/candles
```

---

### Query Parameters

| Name        | Required | Description                            |
| ----------- | -------- | -------------------------------------- |
| `symbol`    | yes      | Trading symbol (e.g. BTCUSDT)          |
| `timeframe` | yes      | Timeframe identifier (e.g. 1m, 5m, 1h) |
| `from`      | yes      | RFC3339 timestamp (inclusive, UTC)     |
| `to`        | yes      | RFC3339 timestamp (exclusive, UTC)     |

---

## Request Handling Rules

* All parameters are required
* Query parameters must be parsed and validated
* Domain value objects must be constructed in the adapter
* Invalid input results in HTTP 400

---

## Response Format

### Success (200)

```json
{
  "symbol": "BTCUSDT",
  "timeframe": "1m",
  "candles": [
    {
      "timestamp": "2024-01-01T00:00:00Z",
      "open": 42000.0,
      "high": 42100.0,
      "low": 41950.0,
      "close": 42050.0,
      "volume": 123.45
    }
  ]
}
```

---

### Error Responses

| Status | Condition                     |
| -----: | ----------------------------- |
|    400 | Invalid or missing parameters |
|    500 | Use case returned error       |

Error body format is **not standardized** in this PR.

---

## Behavioral Specification (Tests Must Cover All)

### Required Test Cases (Minimum)

* `TestGetCandleSeriesHandler_Returns200OnSuccess`
* `TestGetCandleSeriesHandler_Returns400OnInvalidParams`
* `TestGetCandleSeriesHandler_CallsUseCaseWithCorrectArgs`
* `TestGetCandleSeriesHandler_Returns500OnUseCaseError`

Tests must use a **fake GetCandleSeries use case**.

---

## Implementation Constraints

* Adapter depends only on:

  * net/http
  * application use case interface
  * domain objects
* No business logic in handler
* No global variables
* Handler must be testable without running a server

---

## Definition of Done (PR-007)

PR-007 is considered **done** only when **all** conditions below are met:

* [ ] HTTP handler implemented
* [ ] All required handler tests exist
* [ ] Tests fail before implementation
* [ ] Tests pass after implementation
* [ ] Handler performs only translation logic
* [ ] No domain or application logic duplicated
* [ ] No files outside allowed list are changed
* [ ] Static analysis passes with no new warnings
* [ ] CI pipeline is green
* [ ] PR is reviewable in under 15 minutes

---

## Explicit Non-Goals

* No OpenAPI / Swagger generation
* No middleware
* No request logging

---

## Reviewer Checklist

Reviewer must confirm:

* Handler contains no business logic
* All validation is adapter-level only
* Use case is invoked exactly once per request

---

## Guiding Principle

HTTP is a delivery mechanism, not a decision-maker.
