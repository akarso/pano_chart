# PR-024 — Detailed Symbol Endpoint

## Goal

Introduce a detailed symbol endpoint:

```
GET /api/symbol/{symbol}
```

This endpoint provides full chart-ready OHLC data and ranking context for a single symbol.

It is intended for the detailed chart view after clicking a symbol in the overview grid.

---

## Endpoint Contract

### Request

```
GET /api/symbol/BTCUSDT?timeframe=1h&limit=200
```

### Query Parameters

* `timeframe` (required)
* `limit` (optional, default=200, max=1000)

---

## Response

```json
{
  "symbol": "BTCUSDT",
  "timeframe": "1h",
  "candles": [
    {
      "openTime": "2026-02-13T10:00:00Z",
      "open": 42100.0,
      "high": 42250.0,
      "low": 42010.0,
      "close": 42180.0,
      "volume": 1234.56
    }
  ],
  "stats": {
    "totalScore": 0.82,
    "scores": {
      "Gain/Loss": 0.75,
      "Sideways Consistency": 0.04,
      "Trend Predictability": 0.03
    }
  }
}
```

---

## Responsibilities

This endpoint must:

1. Validate symbol exists in current universe
2. Fetch last N complete candles
3. Optionally compute ranking scores for this symbol
4. Return chart-ready OHLC data

It must NOT:

* Perform universe ranking for all symbols
* Fetch unnecessary external data
* Recalculate unrelated symbols

---

## Architecture

New use case:

```
application/usecase/get_symbol_detail.go
```

Dependencies:

```go
type GetSymbolDetail struct {
    candleRepo     CandleRepository
    scorer         SymbolScorer
    universe       SymbolUniverseProvider
    defaultLimit   int
    maxLimit       int
}
```

---

## Execution Flow

1. Validate `symbol` exists in universe
2. Validate timeframe
3. Resolve limit (default + clamp to max)
4. Fetch last N candles
5. Compute scores (optional but recommended)
6. Return DTO

---

## Limit Rules

* Default: 200
* Max: 1000
* If invalid → fallback to default
* Clamp at startup for max safety

This protects memory and payload size.

---

## Candle Fetch Strategy

Must use:

```
GetLastNCandles(symbol, timeframe, limit)
```

* Only complete candles
* Chronological order (oldest → newest)
* No time-range math in use case

---

## Validation Rules

If symbol not in universe:

Return:

```
404 Not Found
```

If timeframe invalid:

```
400 Bad Request
```

If no candles available:

Return empty array with 200 OK.

---

## Performance Expectations

Single symbol request:

* One candle fetch
* One scoring computation
* Expected latency < 200ms

This endpoint must remain lightweight.

---

## Optional Enhancement (Future)

Add optional query flag:

```
includeScores=false
```

Allows frontend to skip score calculation when not needed.

---

## Acceptance Criteria

* Returns full OHLC array
* Candles are chronological
* Limit is respected
* Invalid symbol returns 404
* Invalid timeframe returns 400
* Works with existing candle repository

---

## Product Role

This endpoint powers:

* Full chart view
* Technical indicator overlays (future)
* Detailed score inspection

Together with `/api/overview`, this completes the dashboard API surface.
