# PR-012 — Symbol Scoring Heuristics (Domain)

## Goal

Introduce **deterministic, explainable scoring heuristics** for ranking symbols based on recent price behavior.

This PR establishes the *intelligence layer* of the product — without UI, without HTTP, and without opinionated thresholds.

---

## Scope

**Included**

* Domain-level scoring interfaces
* Concrete heuristic implementations for:

  1. Gainers / losers
  2. Predictable trend (up / down)
  3. Consistent sideways (range / zig-zag)
* Unit tests defining behavior and expectations

**Explicitly Excluded**

* Sorting or ranking orchestration
* Backend adapters or API exposure
* UI or visualization
* Machine learning or probabilistic models

---

## Design Principles

* Scores must be **deterministic** and reproducible
* Each score must be **explainable** in plain language
* Prefer simple math over complex indicators
* No hidden magic constants (all parameters explicit)

---

## Domain Model

### Scoring Interface

```go
// SymbolScoreCalculator evaluates a CandleSeries and returns a normalized score.
type SymbolScoreCalculator interface {
    Name() string
    Score(series CandleSeries) (float64, error)
}
```

Rules:

* Scores are normalized to a comparable range (e.g. -1.0 → 1.0 or 0.0 → 1.0)
* Calculator must not mutate input
* Errors are reserved for invalid input only

---

## Scoring Heuristics

### 1. Gain / Loss Score

**Intent**: identify strongest recent movers.

**Method**:

```
score = (lastClose - firstClose) / firstClose
```

Properties:

* Positive → gainer
* Negative → loser
* Near zero → unchanged

Notes:

* Timeframe and lookback are inherited from the series
* No smoothing or volatility adjustment

---

### 2. Trend Predictability Score (Up / Down)

**Intent**: identify symbols following a clean, consistent trend.

**Method**:

1. Fit a linear regression line over close prices
2. Compute:

   * slope (direction & strength)
   * R² (goodness of fit)

```
trend_score = slope_normalized * R²
```

Properties:

* Strong positive score → clean uptrend
* Strong negative score → clean downtrend
* Near zero → noisy or sideways

Notes:

* Normalization ensures slope comparability across price ranges
* R² penalizes volatility and chop

---

### 3. Sideways / Range Consistency Score

**Intent**: identify symbols exhibiting stable, oscillatory, range-bound behavior.

This score is intentionally **opinionated** and non-standard.

**Conceptual Components**:

1. **Low net displacement**

   * Absolute change between first and last close is small

2. **Stable price envelope**

   * Upper and lower bounds remain consistent over time

3. **Oscillation density**

   * Multiple local extrema (zig-zag behavior)

---

#### Proposed Heuristic

Compute:

* Mean price (regression midline or simple average)
* Upper bound (e.g. rolling max)
* Lower bound (e.g. rolling min)

Metrics:

* Net displacement ratio:

```
abs(lastClose - firstClose) / rangeWidth
```

* Range stability:

```
stdDev(rangeWidth over time)
```

* Oscillation count:

  * Number of local extrema relative to series length

Final score combines:

* Low displacement
* Low range variance
* High oscillation density

Exact weighting is explicit and test-defined.

---

## Test Strategy

Tests act as the **primary specification**.

### Required Tests

* Gain/loss score:

  * increasing series → positive
  * decreasing series → negative
  * flat series → ~0

* Trend score:

  * clean linear trend → high absolute score
  * noisy series → near zero

* Sideways score:

  * bounded oscillating series → high score
  * breakout trend → low score
  * flat line → low score (no oscillation)

### Test Data

* Use synthetic CandleSeries
* Deterministic, hand-crafted price patterns
* No random data

---

## Acceptance Criteria

PR-012 is complete when:

* All three scoring calculators exist
* Calculators are independent and composable
* Unit tests clearly encode intended behavior
* No infrastructure or UI code is touched

---

## Follow-ups

Planned next PRs:

* **PR-013** — Symbol ranking use case
* **PR-014** — Backend exposure (API)
* **PR-015** — Frontend sorting controls

---

## Non-Goals

* Perfect statistical rigor
* Prediction or forecasting
* Machine learning
* Real-time scoring

This PR defines the **analytical vocabulary** of the product.
