# PR-005 — Application Port: CandleRepositoryPort

## Purpose

Introduce the first **application-facing port** for accessing candle data: **CandleRepositoryPort**.

This port defines *what* the application layer can ask for in terms of candle data, without defining *how* the data is obtained.

This PR establishes the boundary between **domain/application** and **infrastructure**.

---

## References

* `AGENTS.md` — global collaboration rules
* `BACKEND.md` — backend architecture & PR sequencing
* `COMMON.md` — shared domain semantics
* `docs/PR-002.md` — Timeframe
* `docs/PR-003.md` — Candle
* `docs/PR-004.md` — CandleSeries

All definitions in this PR must be consistent with the above.

---

## Scope (Hard Lock)

### ✅ Included

* CandleRepositoryPort interface
* Port unit tests (contract tests)

### ❌ Excluded

* Any concrete implementations
* Any infrastructure code
* HTTP / API concerns
* Caching logic
* Pagination or streaming

If it is not **a port definition**, it does not belong here.

---

## Allowed Files

```
/backend/application/ports/candlerepository.go
/backend/tests/application/ports/candlerepository_test.go
```

No other files may be modified.

---

## Port Definition

CandleRepositoryPort is a **read-only** interface responsible for retrieving candles.

It must operate strictly on **domain objects**.

---

## Required Operations

### GetSeries

```
GetSeries(
  symbol Symbol,
  timeframe Timeframe,
  from time.Time,
  to time.Time,
) (CandleSeries, error)
```

Behavioral requirements:

* Returns a CandleSeries ordered by timestamp
* Returned series may be empty
* Returned series may contain gaps
* `from` is inclusive
* `to` is exclusive

---

## Error Semantics

* Invalid arguments must result in an error
* Infrastructure failures must result in an error
* Port must not panic

Error types are **not** specified in this PR.

---

## Behavioral Specification (Tests Must Cover All)

Tests define the **contract**, not an implementation.

### Contract Rules

* Port is an interface only
* No business logic inside the port
* Domain invariants are preserved

---

## Test Requirements

* Tests must compile against the interface
* Tests must not assume any concrete implementation
* Use a fake or stub implementation defined in test scope only

### Required Test Cases (Minimum)

* `TestCandleRepositoryPort_DefinesGetSeriesMethod`
* `TestCandleRepositoryPort_GetSeriesReturnsCandleSeries`
* `TestCandleRepositoryPort_GetSeriesAllowsEmptyResult`

---

## Implementation Constraints

* Interface lives in application layer
* No references to infrastructure packages
* No generics or reflection

---

## Definition of Done (PR-005)

PR-005 is considered **done** only when **all** conditions below are met:

* [ ] CandleRepositoryPort interface exists
* [ ] Interface matches documented signature
* [ ] Contract tests compile and pass
* [ ] No concrete implementations exist
* [ ] No infrastructure code is added
* [ ] No files outside allowed list are changed
* [ ] Static analysis passes with no new warnings
* [ ] CI pipeline is green
* [ ] PR is reviewable in under 10 minutes

---

## Explicit Non-Goals

* No write operations
* No pagination or cursors
* No streaming APIs
* No caching hints

---

## Reviewer Checklist

Reviewer must confirm:

* Port expresses intent clearly
* No accidental logic or implementation leakage
* Interface depends only on domain types

---

## Guiding Principle

Ports define questions, not answers.
