# PR-002 — Domain: Timeframe Value Object

## Purpose

Introduce the **Timeframe** value object into the domain layer.

This PR defines **what a Timeframe is, which values are supported, and how it behaves**, using tests as the primary specification.

No other domain concepts may be introduced in this PR.

---

## References

* `AGENTS.md` — global collaboration rules
* `BACKEND.md` — backend architecture & PR sequencing
* `COMMON.md` — shared Timeframe semantics

This PR must comply with all three documents.

---

## Scope (Hard Lock)

### ✅ Included

* Timeframe value object (domain)
* Timeframe unit tests

### ❌ Excluded

* Any other domain objects
* Any ports or adapters
* Any application logic
* Any infrastructure code

If it is not **Timeframe**, it does not belong here.

---

## Allowed Files

```
/backend/domain/timeframe.go
/backend/tests/domain/timeframe_test.go
```

No other files may be modified.

---

## Behavioral Specification (Tests Must Cover All)

### Supported Values

The following timeframe identifiers are supported:

* `1m`
* `5m`
* `15m`
* `1h`
* `4h`
* `1d`

Any other value must be rejected.

---

### Creation Rules

* Accepts only supported timeframe identifiers
* Rejects empty strings
* Rejects unsupported identifiers
* Rejects malformed values

Examples of invalid values:

* `2m`
* `30m`
* `0m`
* `1hour`
* `15`

---

### Normalization Rules

* Timeframe identifiers are normalized on creation
* Normalized representation matches canonical values exactly

Examples:

* `15M` → `15m`
* `1H` → `1h`

---

### Immutability Rules

* Timeframe is immutable after creation
* No setters or mutation methods

---

### Equality Semantics

* Timeframes are equal if their canonical values are equal
* Equality is value-based, not reference-based

---

### Duration Exposure

* Timeframe exposes its duration as a time value
* Duration must match canonical meaning

Examples:

* `1m` → 1 minute
* `15m` → 15 minutes
* `1h` → 1 hour
* `1d` → 24 hours

---

## Test Requirements

* Tests must be written **before** implementation
* Each test covers exactly one behavior
* Table-driven tests are preferred

### Required Test Cases (Minimum)

* `TestTimeframe_AcceptsSupportedValues`
* `TestTimeframe_RejectsEmptyString`
* `TestTimeframe_RejectsUnsupportedValues`
* `TestTimeframe_NormalizesCanonicalForm`
* `TestTimeframe_EqualityByValue`
* `TestTimeframe_ExposesCorrectDuration`

---

## Implementation Constraints

* Timeframe is a value object
* No external dependencies
* Supported values must be explicit (no dynamic parsing)
* Constructor performs all validation

---

## Definition of Done (PR-002)

PR-002 is considered **done** only when **all** conditions below are met:

* [ ] All required Timeframe tests are implemented
* [ ] Tests fail before Timeframe implementation is added
* [ ] Tests pass after implementation
* [ ] No tests exist outside Timeframe scope
* [ ] No production code exists outside `domain/timeframe.go`
* [ ] Timeframe is immutable
* [ ] Supported values are explicitly defined
* [ ] Duration mapping is fully tested
* [ ] Static analysis passes with no new warnings
* [ ] CI pipeline is green
* [ ] PR is reviewable in under 10 minutes

---

## Explicit Non-Goals

* No dynamic or user-defined timeframes
* No exchange-specific timeframe mapping
* No scheduling or clock logic

---

## Reviewer Checklist

Reviewer must confirm:

* Tests clearly describe Timeframe behavior
* Implementation matches tests exactly
* No scope creep occurred

---

## Guiding Principle

A finite set of timeframes is a feature, not a limitation.
