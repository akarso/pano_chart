# PR-002 — API Client Port & DTO Definitions

## Purpose

Introduce the **frontend-side API boundary** for communicating with the backend `/api/v1/candles` endpoint defined in `docs/PR-011.md`.

This PR establishes:

* A client **port (interface)**
* Immutable DTOs matching the frozen API contract

No networking implementation is provided yet.

---

## References

* `AGENTS.md` — global collaboration rules
* `COMMON.md` — shared semantics
* `frontend/PR-001.md` — app skeleton
* `docs/PR-011.md` — frozen backend API contract

Frontend must not infer behavior beyond the contract.

---

## Scope (Hard Lock)

### ✅ Included

* API client interface (port)
* Request parameter objects
* Response DTOs
* Serialization / deserialization tests

### ❌ Excluded

* HTTP client implementation
* Retry or caching logic
* UI or state management
* Error presentation

If it performs a network call, it does not belong here.

---

## Folder Structure

```
/frontend/lib/
  features/candles/
    api/
      candle_api.dart        // port (interface)
      candle_request.dart    // query parameters
      candle_response.dart   // DTOs

/frontend/test/
  features/candles/api/
```

---

## API Client Port

### CandleApi (Interface Only)

Responsibilities:

* Fetch candle series data
* Accept explicit request object
* Return typed response or failure

Constraints:

* Asynchronous API
* No dependency on Flutter widgets
* No side effects

---

## Request Object

### CandleRequest

Fields must map **1:1** to query parameters:

* `symbol`
* `timeframe`
* `from`
* `to`

Validation rules:

* Required fields enforced at construction
* No default values

---

## Response DTOs

### CandleDto

Fields:

* `timestamp` (UTC, RFC3339)
* `open`
* `high`
* `low`
* `close`
* `volume`

DTOs must be:

* Immutable
* Equality comparable
* JSON-serializable

---

### CandleSeriesResponse

Fields:

* `symbol`
* `timeframe`
* `candles` (ordered list)

Empty candle list is valid.

---

## Testing Requirements

### Required Test Cases

* `CandleRequest_requiresAllFields`
* `CandleDto_serializesFromJson`
* `CandleSeriesResponse_handlesEmptyList`

Tests act as the **specification** for DTO behavior.

---

## Implementation Constraints

* No HTTP or Dio dependencies
* Use Dart core libraries only
* No code generation (e.g. json_serializable)

Manual serialization is intentional at this stage.

---

## Definition of Done (PR-002)

PR-002 is considered **done** only when **all** conditions below are met:

* [ ] API client port defined
* [ ] DTOs match backend contract exactly
* [ ] All DTOs are immutable
* [ ] Serialization/deserialization tested
* [ ] Static analysis passes
* [ ] No networking code exists
* [ ] PR is reviewable in under 20 minutes

---

## Explicit Non-Goals

* No pagination support
* No error modeling beyond basic failure

---

## Reviewer Checklist

Reviewer must confirm:

* DTOs reflect frozen API contract
* No assumptions beyond PR-011
* Port is minimal and future-proof

---

## Guiding Principle

Contracts first, transports later.
